<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pesanan Es Krim</title>
    <link rel="stylesheet" type="text/css" href="styless.css">
</head>
<body>
    <div class="container">
        <h1>Pesan Es Krim</h1>
        <img src="es krim enak.jpg" class="ice-cream-img" alt="Es Krim Enak">
        <label for="name">Nama:</label>
        <input type="text" id="name" name="name" required>
        <form id="orderForm" action="/order" method="post" onsubmit="generateTicket(event)">
            <label>Pilih Rasa Es Krim (Utama):</label>
            <div class="radio-group" id="flavorGroup">
                <!-- Pilihan rasa utama (radio) -->
                <div class="radio-item">
                    <input type="radio" id="vanilla" name="flavor" value="vanilla" data-price="20000" required>
                    <label for="vanilla">1. Vanilla (Rp 20.000)</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="chocolate" name="flavor" value="chocolate" data-price="22000">
                    <label for="chocolate">2. Coklat (Rp 22.000)</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="strawberry" name="flavor" value="strawberry" data-price="22000">
                    <label for="strawberry">3. Stroberi (Rp 22.000)</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="mint" name="flavor" value="mint" data-price="23000">
                    <label for="mint">4. Mint (Rp 23.000)</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="durian" name="flavor" value="durian" data-price="25000">
                    <label for="durian">5. Durian (Rp 25.000)</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="mangga" name="flavor" value="mangga" data-price="21000">
                    <label for="mangga">6. Mangga (Rp 21.000)</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="matcha" name="flavor" value="matcha" data-price="24000">
                    <label for="matcha">7. Matcha (Rp 24.000)</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="blueberry" name="flavor" value="blueberry" data-price="23000">
                    <label for="blueberry">8. Blueberry (Rp 23.000)</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="caramel" name="flavor" value="caramel" data-price="22000">
                    <label for="caramel">9. Caramel (Rp 22.000)</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="pistachio" name="flavor" value="pistachio" data-price="25000">
                    <label for="pistachio">10. Pistachio (Rp 25.000)</label>
                </div>
            </div>

            <label>Mix Rasa (opsional, maksimal 2):</label>
            <div class="checkbox-group" id="mixFlavorGroup">
                <div class="checkbox-item">
                    <input type="checkbox" id="mix-vanilla" name="mixFlavor" value="vanilla" data-price="20000">
                    <label for="mix-vanilla">Vanilla</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="mix-chocolate" name="mixFlavor" value="chocolate" data-price="22000">
                    <label for="mix-chocolate">Coklat</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="mix-strawberry" name="mixFlavor" value="strawberry" data-price="22000">
                    <label for="mix-strawberry">Stroberi</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="mix-mint" name="mixFlavor" value="mint" data-price="23000">
                    <label for="mix-mint">Mint</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="mix-durian" name="mixFlavor" value="durian" data-price="25000">
                    <label for="mix-durian">Durian</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="mix-mangga" name="mixFlavor" value="mangga" data-price="21000">
                    <label for="mix-mangga">Mangga</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="mix-matcha" name="mixFlavor" value="matcha" data-price="24000">
                    <label for="mix-matcha">Matcha</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="mix-blueberry" name="mixFlavor" value="blueberry" data-price="23000">
                    <label for="mix-blueberry">Blueberry</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="mix-caramel" name="mixFlavor" value="caramel" data-price="22000">
                    <label for="mix-caramel">Caramel</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="mix-pistachio" name="mixFlavor" value="pistachio" data-price="25000">
                    <label for="mix-pistachio">Pistachio</label>
                </div>
            </div>
            <script>
            // Batasi mix rasa maksimal 2
            document.querySelectorAll('input[name="mixFlavor"]').forEach(cb => {
                cb.addEventListener('change', function() {
                    const checked = document.querySelectorAll('input[name="mixFlavor"]:checked');
                    if (checked.length > 2) {
                        this.checked = false;
                        alert('Maksimal pilih 2 rasa untuk Mix Rasa!');
                    }
                });
            });
            </script>

            <label>Topping:</label>
            <div class="checkbox-group">
                <!-- Pilihan topping -->
                <div class="checkbox-item">
                    <input type="checkbox" id="sprinkles" name="toppings" value="sprinkles" data-price="5000">
                    <label for="sprinkles">Sprinkles (Rp 5.000)</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="chocochips" name="toppings" value="chocochips" data-price="8000">
                    <label for="chocochips">Choco Chips (Rp 8.000)</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="nuts" name="toppings" value="nuts" data-price="7000">
                    <label for="nuts">Kacang (Rp 7.000)</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="caramel_sauce" name="toppings" value="caramel_sauce" data-price="6000">
                    <label for="caramel_sauce">Saus Karamel (Rp 6.000)</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="whipped_cream" name="toppings" value="whipped_cream" data-price="7000">
                    <label for="whipped_cream">Whipped Cream (Rp 7.000)</label>
                </div>
            </div>

            <label for="size">Ukuran:</label>
            <select id="size" name="size" required>
                <option value="small" data-price="10000">Kecil (Rp 10.000)</option>
                <option value="medium" data-price="15000">Sedang (Rp 15.000)</option>
                <option value="large" data-price="20000">Besar (Rp 20.000)</option>
            </select>

            <label>Pilih Tempat:</label>
            <div class="radio-group">
                <!-- Pilihan tempat -->
                <div class="radio-item">
                    <input type="radio" id="cup" name="container" value="cup" data-price="5000" required>
                    <label for="cup">Cup (Rp 5.000)</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="cone" name="container" value="cone" data-price="7000">
                    <label for="cone">Cone (Rp 7.000)</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="waffle" name="container" value="waffle" data-price="10000">
                    <label for="waffle">Waffle (Rp 10.000)</label>
                </div>
            </div>

            <div class="quantity-group">
                <!-- Jumlah -->
                <label for="quantity">Jumlah:</label>
                <input type="number" id="quantity" name="quantity" min="1" max="10" value="1" required>
                <p id="quantity-error" class="error-message" style="display: none;">Jumlah maksimal adalah 10.</p>
            </div>

            <label for="order-description">Deskripsi Pesanan:</label>
            <textarea id="order-description" name="order-description" rows="4" cols="50" placeholder="Masukkan deskripsi atau permintaan khusus Anda di sini..."></textarea>
            
            <div class="submit-button">
                <input type="submit" value="Pesan Sekarang">
            </div>
        </form>
    </div>
    
    <div class="button-container">
        <div class="pesanan-es">
            <form action="tokoeskrim.html">
                <input type="submit" value="Kembali" class="button-back">
            </form>
        </div>
    </div>
<!-- Bagian jam -->
<div class="clock-container" id="clock"></div>

<script>
    function generateTicket(event) {
        event.preventDefault();

        const quantityInput = document.getElementById('quantity');
        const quantity = parseInt(quantityInput.value);

        if (quantity > 10) {
            document.getElementById('quantity-error').style.display = 'block';
            return;
        } else {
            document.getElementById('quantity-error').style.display = 'none';
        }

        const name = document.getElementById('name').value;
        const flavorRadio = document.querySelector('#flavorGroup input[type="radio"]:checked');
        if (!flavorRadio) {
            alert('Pilih satu rasa utama!');
            return;
        }
        const flavor = flavorRadio.value;
        const flavorText = flavorRadio.nextElementSibling.textContent.split(' (')[0];
        const flavorPrice = parseInt(flavorRadio.getAttribute('data-price'));
        const mixChecked = Array.from(document.querySelectorAll('input[name="mixFlavor"]:checked'));
        const mixFlavor = mixChecked.map(cb => cb.value);
        const mixFlavorText = mixChecked.map(cb => cb.nextElementSibling.textContent).join(', ');
        const mixFlavorPrice = mixChecked.reduce((sum, cb) => sum + parseInt(cb.getAttribute('data-price')), 0);
        const toppings = Array.from(document.querySelectorAll('input[name="toppings"]:checked')).map(el => el.nextElementSibling.textContent.split(' ')[0]);
        const sizeSelect = document.getElementById('size');
        const sizeOption = sizeSelect.options[sizeSelect.selectedIndex];
        const size = sizeOption ? sizeOption.textContent.split(' ')[0] : 'Tidak ada';
        const sizePrice = sizeOption ? parseInt(sizeOption.getAttribute('data-price')) : 0;
        const container = document.querySelector('input[name="container"]:checked');
        const orderDescription = document.getElementById('order-description').value;

        // Menghitung harga
        let containerPrice = parseInt(container ? container.getAttribute('data-price') : 0);
        let toppingsPrice = Array.from(document.querySelectorAll('input[name="toppings"]:checked')).reduce((sum, topping) => sum + parseInt(topping.getAttribute('data-price')), 0);
        let totalPrice = (flavorPrice + mixFlavorPrice + sizePrice + containerPrice + toppingsPrice) * quantity;

        // Mendapatkan tanggal saat ini
        const today = new Date().toISOString().split('T')[0];
        const time = new Date().toLocaleTimeString();

        // Mendapatkan nomor antrian terakhir dan tanggalnya dari localStorage
        let storedData = localStorage.getItem('ticketData');
        let ticketNumber = 1;

        if (storedData) {
            let data = JSON.parse(storedData);
            if (data.date === today) {
                ticketNumber = data.number + 1;
            }
        }

        // Menyimpan nomor antrian dan tanggal saat ini di localStorage
        localStorage.setItem('ticketData', JSON.stringify({ date: today, number: ticketNumber }));

        // Simpan data pesanan ke localStorage (riwayat)
        let orderHistory = JSON.parse(localStorage.getItem('orderHistory') || '[]');
        orderHistory.push({
            ticketNumber: ticketNumber,
            name: name,
            flavor: flavorText,
            mixFlavor: mixFlavorText,
            toppings: toppings.length ? toppings.join(', ') : 'Tidak ada',
            size: size,
            container: container ? container.nextElementSibling.textContent.split(' (')[0] : 'Tidak ada',
            quantity: quantity,
            orderDescription: orderDescription || 'Tidak ada',
            totalPrice: totalPrice,
            time: time,
            status: 'Menunggu'
        });
        localStorage.setItem('orderHistory', JSON.stringify(orderHistory));

        const ticket = `
            <div class="ticket-container">
                <div class="ticket-header">
                    <h2>Tiket Antrian</h2>
                    <span class="ticket-number">No. ${ticketNumber}</span>
                </div>
                <div class="ticket-content">
                    <p><strong>Nama:</strong> ${name}</p>
                    <p><strong>Rasa Utama:</strong> ${flavorText}</p>
                    <p><strong>Mix Rasa:</strong> ${mixFlavorText || '-'}</p>
                    <p><strong>Topping:</strong> ${toppings.length ? toppings.join(', ') : 'Tidak ada'}</p>
                    <p><strong>Ukuran:</strong> ${size}</p>
                    <p><strong>Tempat:</strong> ${container ? container.nextElementSibling.textContent.split(' (')[0] : 'Tidak ada'}</p>
                    <p><strong>Jumlah:</strong> ${quantity}</p>
                    <p><strong>Deskripsi Pesanan:</strong> ${orderDescription || 'Tidak ada'}</p>
                    <p><strong>Total Harga:</strong> Rp ${totalPrice.toLocaleString()}</p>
                    <p><strong>Waktu:</strong> ${new Date().toLocaleTimeString()}</p>
                </div>
                <div class="ticket-footer">
                    <form action="tokoeskrim.html">
                        <input type="submit" value="Kembali" class="button-back">
                    </form>
                </div>
            </div>
        `;

        document.body.innerHTML = ticket;
    }

    function updateClock() {
        const now = new Date();
        const hours = now.getHours().toString().padStart(2, '0');
        const minutes = now.getMinutes().toString().padStart(2, '0');
        const seconds = now.getSeconds().toString().padStart(2, '0');
        document.getElementById('clock').textContent = `${hours}:${minutes}:${seconds}`;
    }

    setInterval(updateClock, 1000);
    updateClock(); // Initialize clock immediately
</script>
</body>
</html>
